<%- include('../../views/partials/user/header') %>
<%- include('../../views/partials/user/user-side') %>

<style>
    .badge{
        background-color:#0000002c;
        font-size: 12px;
    }
.list-group-item {
    position: relative;
}

.more-options {
    position: absolute;
    top: 10px;
    right: 10px;
}

.more-options .btn {
    padding: 0;
    background: transparent;
    border: none;
    cursor: pointer;
    color: inherit;
}


.more-options i {
    color: #333; /* You can change this to any color you prefer */
}

/* Optional: Change the color when hovering over the button */
.more-options .btn:hover i {
    color: #000; /* Set the hover color for the icon */
}

/* Dropdown list initially hidden */
.dropdown-list {
    display: none;
    position: absolute;
    right: 0;
    top: 0;
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.1);
    width: 100px;
    z-index: 10;
}

/* Show the dropdown when hovering over the 3-dot button */
.more-options:hover .dropdown-list {
    display: block;
}

/* Style the dropdown items */
.dropdown-item {
    padding: 8px 12px;
    text-decoration: none;
    color: #333;
    cursor: pointer;
    display: block;
    font-size: 14px;
}

/* Hover effect for dropdown items */
.dropdown-item:hover {
    background-color: #f0f0f0;
    color: rgba(0, 0, 255, 0.616);
}
.error-message {
    color: red;
    font-size: 14px;
}

.form-check-label{
    margin-bottom: 23px;
    font-size: 14px;
    font-weight: 600;
}
</style>



<div class="content-area container mt-5">
    <% if (address.length === 0) { %>
        <!-- Message when no addresses are available -->
        <div class="text-center">
            <p class="fs-4">There is no address available. <br> <button class="btn btn-primary mt-3" id="showFormBtn">Add New Address</button></p>
        </div>
    <% } else { %>
        <!-- Display existing addresses -->
        <h3 class="mb-4">Your Addresses</h3>
        <ul class="list-group mb-4">
            <% address.forEach(function(doc) { %>
                <% doc.address.forEach(function(addr) { %>
                    <li class="list-group-item">
                        <h6><%= addr.recipient_name %>
                            <% if (addr.addressType) { %>
                                <span class="badge mb-2"><%=addr.addressType%></span>
                            <% } %>
                        </h4>
                        <strong><%= addr.streetAddress %>, <%= addr.city %>, <%= addr.state %></strong><br>
                        Pincode: <%= addr.pincode %> <br>
                        Landmark: <%= addr.landMark || 'N/A' %><br>
                        <span class="text-muted">Phone: <%= addr.phone || 'N/A' %></span>
                        <div class="more-options">
                        <button class="btn btn-link"><i class="fa-solid fa-ellipsis-vertical"></i></button>
                        <div class="dropdown-list">
                          <ul>
                          <li><a href="#" class="dropdown-item">Edit</a>
                          <li><a href="#" class="dropdown-item">Delete</a>
                         </ul>
                        </div>
                        </div>
                    </li>
                <% }); %>
            <% }); %>
        </ul>
        <!-- Button to show the form -->
        <button class="btn btn-primary" id="showFormBtn">Add New Address</button>
    <% } %>

    <!-- Address Form (Initially Hidden) -->
    <div class="mt-5" id="addressFormContainer" style="display: none;">
        <h2 class="mb-4">Add New Address</h2>
        <form id="addressForm" action="/address-view" method="POST">
            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="recipient_name">
                <div id="error1" class="error-message"></div>
            </div>
            <div class="mb-3">
                <label for="streetAddress" class="form-label">Street Address</label>
                <input type="text" class="form-control" id="streetAddress" name="streetAddress">
                <div id="error2" class="error-message"></div>
            </div>
            <div class="mb-3">
                <label for="city" class="form-label">City</label>
                <input type="text" class="form-control" id="city" name="city">
                <div id="error3" class="error-message"></div>
            </div>
            <div class="mb-3">
                <label for="state" class="form-label">State</label>
                <input type="text" class="form-control" id="state" name="state">
                <div id="error4" class="error-message"></div>
            </div>
            <div class="mb-3">
                <label for="landMark" class="form-label">Landmark (Optional)</label>
                <input type="text" class="form-control" id="landMark" name="landMark">
            </div>
            <div class="mb-3">
                <label for="pincode" class="form-label">Pincode</label>
                <input type="text" class="form-control" id="pincode" name="pincode">
                <div id="error5" class="error-message"></div>
            </div>

            <div class="mb-3">
                <label for="Phone" class="form-label">Phone No:</label>
                <input type="tel" class="form-control" id="phone" name="phone"  placeholder="10-digit phone number">
                <div id="error6" class="error-message"></div>
            </div>
            <div class="mb-3">
                <label for="altPhone" class="form-label">Alternate Phone (Optional)</label>
                <input type="tel" class="form-control" id="altPhone" name="altPhone"  placeholder="10-digit phone number">
            </div>

            <div class="mb-3">
                <label class="form-label">Address Type</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="addressType" id="home" value="Home">
                    <label class="form-check-label" for="home">Home</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="addressType" id="work" value="Work">
                    <label class="form-check-label" for="work">Work</label>
                </div>
                <div id="error7" class="error-message"></div>
            </div>

            <button type="submit" class="btn btn-primary mt-3">Add Address</button>
        </form>
        </div>
    </div>
</div>
</div>

<script>
    // JavaScript to toggle the visibility of the form
    document.getElementById('showFormBtn').addEventListener('click', function() {
        const formContainer = document.getElementById('addressFormContainer');
        formContainer.style.display = (formContainer.style.display === 'none' || formContainer.style.display === '') ? 'block' : 'none';
    });
</script>


<script>
    const addressForm = document.getElementById('addressFormContainer')
    const name = document.getElementById('name')
    const streetAddress = document.getElementById('streetAddress')
    const city = document.getElementById('city')
    const state = document.getElementById('state')
    const pincode = document.getElementById('pincode')
    const phone = document.getElementById('phone')

    const err1 = document.getElementById('error1')
    const err2 = document.getElementById('error2')
    const err3 = document.getElementById('error3')
    const err4 = document.getElementById('error4')
    const err5 = document.getElementById('error5')
    const err6 = document.getElementById('error6')

const addressTypeInputs = document.getElementsByName('addressType');
const err7 = document.getElementById('error7');

function addressTypeValidation() {
    const isSelected = Array.from(addressTypeInputs).some(input => input.checked);
    if (!isSelected) {
        err7.innerText = "Please select an address type";
    } else {
        err7.innerText = "";
    }
}

addressTypeInputs.forEach(input => input.addEventListener('change', addressTypeValidation));


function nameValidation(){
    const nameVal = name.value.trim();
    const namePattern = /^[a-zA-Z\s]{2,50}$/;
    if (nameVal === "") {
        err1.innerText = "Please enter the full name";
    } else if (!namePattern.test(nameVal)) {
        err1.innerText = "Name can only contain alphabets and spaces";
    } else {
        err1.innerText = "";
    }
}

name.addEventListener('blur',nameValidation)
streetAddress.addEventListener('blur',addressValidation)
city.addEventListener('blur',addressValidation)
state.addEventListener('blur',addressValidation)
pincode.addEventListener('blur',addressValidation)
phone.addEventListener('blur',addressValidation)


function addressValidation(){
    const streetVal = streetAddress.value.trim()
    const cityVal = city.value.trim();
    const stateVal = state.value.trim();
    const pincodeVal = pincode.value.trim();
    const phoneVal = phone.value.trim()
    const phonePattern = /^(\+\d{1,3}[- ]?)?\d{10}$/;
    const pincodePattern = /^\d{6}$/;
    const allZero = /^0+$/;


   
    if (streetVal === "") {
        err2.innerText = "Please enter street address";
    } else {
        err2.innerText = "";
    }

    if (cityVal === "") {
        err3.innerText = "Please enter city";
    } else {
        err3.innerText = "";
    }

    if (stateVal === "") {
        err4.innerText = "Please enter state";
    } else {
        err4.innerText = "";
    }

    if (!pincodePattern.test(pincodeVal)) {
        err5.innerText = "Enter a valid 6-digit pincode";
    } else if(allZero.test(pincodeVal)){
        err5.innerText = "Pincode cannot be all zeros!";
    }else {
        err5.innerText = "";
    }

    if (allZero.test(phoneVal)) {
        err6.innerText = "Phone number cannot be all zeros!";
    } else if (!phonePattern.test(phoneVal)) {
        err6.innerText = "Enter a valid phone number";
    } else {
        err6.innerText = "";
    }

}



addressForm.addEventListener('submit',(e)=>{
    nameValidation();
    addressValidation();
    addressTypeValidation();
    const hasError = [err1, err2, err3, err4, err5, err6].some(err => err.innerText !== "");
    if (hasError) {
        e.preventDefault();
    }
})


</script>
<%- include('../../views/partials/user/footer') %>
